env:
  global:
  - PERL5LIB=/usr/share/perl5
language: python
dist: xenial
python:
- '2.7'
branches:
  only:
  - master
before_install:
- sudo apt-get -y install graphviz
- sudo apt-get -y install cpanminus
- sudo apt-get -y install libgraphviz-perl
- sudo apt-get -y install liblog4perl-perl
- cpanm --local-lib=~/perl5 local::lib && eval $(perl -I ~/perl5/lib/perl5/ -Mlocal::lib)
- cpanm Module::Build
install:
- pip install -r model-desc/reqs.txt
- pushd make-model
- perl Build.PL
- yes | ./Build installdeps --cpan_client cpanm
- "./Build test --verbose"
- ls -lR .
- "./Build install"
script:
- popd
- pushd model-desc
- pytest && cp icdc-model.yml icdc-model-props.yml ../docs/model-desc && model-tool
  -g ../docs/model-desc/icdc-model.svg ../docs/model-desc/icdc-model.yml ../docs/model-desc/icdc-model-props.yml
deploy:
  provider: pages
  skip_cleanup: true
  local_dir: docs/model-desc
  github_token:
    - secure: KfZEw6PnFRWoxyteHcVo4iphWOy8X6GwczIJsBbb6lXJD9P15qjCmHfq00yJeV0QNgAvyiFlEuVwzSTEi+4hQbDPs8rc8LPyu2Ao5CK4EpKNQlv5tW9fLO1J2cmlVckMLpsdSZPmxE3/T1PqLkAc8Mn42lW237Wed7iiGAdfcsEAcnhY4cZ6+g9vTYrjsWp8MbL0glPh7r+YvlP3cBMJGj31xlYYn9d0N27Cq/dy2nJDV1/E3Yevkvk4SEMHKieO1R29CsH2RuGmjCZKSr/jkj4zFJr1/8Spgb+9FCErui6KCz0rWBJ8yawsIMHjp7Bq25jUoIQKCICbk+Qx+bs0GxzHCjVOKGAygUaWRud0V8cPtZ48YaeYAgcTbmuuY4OTFA4qoOCASdCjabcbz80bTI4TL36Nx2yocrTC6HPh9jvGnMLgBn+iayBZD5al7XHVT1sZtsqAwDhWhfDr0F81NZI87MpI0Akwk0kDvP8TjX1YK/H3J0tX+f/5I12t5wlTG0yc82uvrK3kQ3Ll9XkPcPU6piOFfT/6JmoatirUH5DFIjfu0B4nCQLDntuys+ZN5GqpzcNihTPmr4lmt6PCdX3j4sxFeIyoT34f/rjxxq9+U1wWODWengnsgCe/g0KkEpbT02nfIX+41oYojpIapnXjXbkGlQRU5BbE0aB0ln4=
  keep_history: true
  verbose: true
  on:
    branch: master
