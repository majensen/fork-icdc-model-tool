env:
  global:
  - PERL5LIB=/usr/share/perl5
language: python
dist: xenial
python:
- '2.7'
branches:
  only:
  - master
before_install:
- sudo apt-get -y install graphviz
- sudo apt-get -y install cpanminus
- sudo apt-get -y install libgraphviz-perl
- cpanm --local-lib=~/perl5 local::lib && eval $(perl -I ~/perl5/lib/perl5/ -Mlocal::lib)
- cpanm Module::Build
install:
- pip install -r model-desc/reqs.txt
- pushd make-model
- perl Build.PL
- yes | ./Build installdeps --cpan_client cpanm
- "./Build test --verbose"
- ls -lR .
- "./Build install"
script:
- popd
- pushd model-desc
- pytest && cp icdc-model.yml icdc-model-props.yml ../docs/model-desc && model-tool
  -g ../docs/model-desc/icdc-model.svg ../docs/model-desc/icdc-model.yml ../docs/model-desc/icdc-model-props.yml
deploy:
  provider: pages
  skip_cleanup: true
  local_dir: docs/model-desc
  github_token:
    - secure: "LB9bRS5tc7S7lKdwrMX50U3JEbM2Y1G4gayZsbJgEQ6W4V/ByjikE29+thhEcU0VDZYKQUBxeVQgHAQ/KSvZYK68+JET19mCqOZheM65u4yajRVQfSNKa5ZvlgiAwWjrRFKZFQ/DRuIlwGy0j41W1wvyTFBcZiUyDQQ3wZRG2VHQXue4/fx27IAuAC+UtPhoGla5INgjOa98jwSqtrcr8koHK/IK1DSdps+UppRWb4HW1drkJeyt/qERvt5vpvOdLunKbKJr8JjI1TpQN6OGMZvo1n6MhZb5GNygRmPfpnVzDquN/aSyn/Y6pW7AtQKopmBJqMLsMvnTLd16cjOwpLXw7FnvhG/H/2uFB2t/fmVXbdZ6EVxP9tZ2CJb9hCjo79OCF8+HEuS4b0wpcRwbQ4O84NLnh7mQV5rb8msCLG008+pmyM1TDt0gjqfrAhVmUFXRdmyNNz0PjTg6PpHvLToyHThCENShz/tmwJHxYqojH261o1IfYw78Q2KnRGPpyGbsZtJB2viQHzy6kkn2T/IToh9UY/b1ZRTqJyj4ZIbB0ivy7eQyBxurLpMY8fRuq1N24Ha7WWD41SR3p2ZbnAgmzJcRLn2dXy5MTQs8AA73URGv/az1IKGHZPCYVC6aLW4K9t6+aR1gAwGGZS+KTKxiF/AiBKci5HbfKHwP/Ps="
  keep_history: true
  verbose: true
  on:
    branch: master
